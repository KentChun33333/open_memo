# Walkthrough: Prompt Optimization (2025-02-05)

I have overhauled the prompt architecture to separate **Static Protocol** from **Dynamic State**.

## Changes Made

### 1. Protocol Enrichment (`prompt.py`)

- **Added Governance**: `SKILL.md` is now explicitly defined as the "Supreme Law".
- **Meta-Tool Architecture**: Instructions now prioritize specialized scripts in `scripts/` over generic commands.
- **Lifecycle Awareness**: Added rules for respecting `init` and `validate` phases.

### 2. Prompt Separation

- **Static System Prompt**: `SUBAGENT_INSTRUCTION` now strictly contains the Role, Skill Manual, and Protocol. It does NOT contain task state.
- **Dynamic User Trigger**: `USER_DYNAMIC_CONTEXT_TEMPLATE` injects the Task, SOP, Roadmap, Files, and Alerts at the start of the conversation.

### 3. Smart Data Views (`structs.py`)

- **Refactored**: Replaced the monolithic `to_xml()` with specialized views:
  - `to_system_protocol_view()`: Returns the XML for the System Prompt.
  - `to_user_status_view()`: Returns the formatted Context for the User Prompt.
- **Benefit**: Ensures the StepExecutor always uses the correct "slice" of data for each prompt type, eliminating duplication.

## Verification

- **Syntax**: Verified python compilation of `step_executor.py`, `structs.py`, and `prompt.py`.
